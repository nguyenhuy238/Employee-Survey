@model List<Employee_Survey.Domain.Test>

<h2>Tests</h2>

@if (TempData["Msg"] != null)
{
    <div class="alert alert-success">@TempData["Msg"]</div>
}

<a class="btn btn-success" href="/Tests/Create">Create</a>

<table class="table mt-3">
    <thead>
        <tr>
            <th>Title</th>
            <th>Duration</th>
            <th>Pass</th>
            <th>Skill</th>
            <th>Status</th>
            <th>Published At</th>
            <th style="width:420px">Action</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var t in Model)
        {
            <tr>
                <td>@t.Title</td>
                <td>@t.DurationMinutes min</td>
                <td>@t.PassScore</td>
                <td>@t.SkillFilter</td>
                <td>
                    @if (t.IsPublished)
                    {
                        <span class="badge bg-success">Published</span>
                    }
                    else
                    {
                        <span class="badge bg-warning text-dark">Draft</span>
                    }
                </td>
                <td>@(t.PublishedAt?.ToLocalTime().ToString("yyyy-MM-dd HH:mm") ?? "-")</td>
                <td>
                    <a class="btn btn-sm btn-outline-primary me-2" href="/Tests/Assign/@t.Id">Assign Users</a>
                    <a class="btn btn-sm btn-outline-secondary me-2" href="/Tests/Edit/@t.Id">Edit</a>

                    <form method="post" action="/Tests/ToggleStatus" class="d-inline">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="id" value="@t.Id" />
                        @if (t.IsPublished)
                        {
                            <button class="btn btn-sm btn-warning me-2" onclick="return confirm('Chuyển về Draft?');">Unpublish</button>
                        }
                        else
                        {
                            <button class="btn btn-sm btn-success me-2">Publish</button>
                        }
                    </form>

                    <form method="post" action="/Tests/Delete" class="d-inline" onsubmit="return confirm('Xoá bài test này?');">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="id" value="@t.Id" />
                        <button class="btn btn-sm btn-danger">Delete</button>
                    </form>

                    <form method="post" action="/Tests/AssignToUser" class="d-inline ms-2">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="testId" value="@t.Id" />
                        <input class="form-control form-control-sm d-inline" style="width:160px" name="userId" placeholder="userId (vd: u-emp)" />
                        <button class="btn btn-sm btn-primary">Quick Assign</button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>
