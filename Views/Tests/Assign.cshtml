@model Employee_Survey.Models.AssignUsersViewModel
@{
    ViewData["Title"] = "Assign Users";
}
<h2>Assign Users to Test</h2>
<div class="mb-2"><a class="btn btn-secondary" href="/Tests">Back</a></div>

<div class="alert alert-info">
    <i class="bi bi-info-circle"></i>
    <strong>Lưu ý:</strong> Test sẽ được tự động publish khi assign. Nếu không chọn thời gian, test sẽ có hiệu lực từ hôm qua đến 30 ngày tới.
</div>

<div class="card p-3 mb-3">
    <div><strong>Test:</strong> @Model.TestTitle (@Model.TestId)</div>
    <form method="post" asp-action="Assign" asp-controller="Tests">
        @Html.AntiForgeryToken()
        <input type="hidden" name="testId" value="@Model.TestId" />
        <div class="row g-2 align-items-end mb-3">
            <div class="col-auto">
                <label class="form-label">Start At (UTC)</label>
                <input type="datetime-local" class="form-control" name="startAt" 
                       value="@DateTime.UtcNow.AddDays(-1).ToString("yyyy-MM-ddTHH:mm")" />
            </div>
            <div class="col-auto">
                <label class="form-label">End At (UTC)</label>
                <input type="datetime-local" class="form-control" name="endAt" 
                       value="@DateTime.UtcNow.AddDays(30).ToString("yyyy-MM-ddTHH:mm")" />
            </div>
            <div class="col-auto">
                <button class="btn btn-primary">Save Assignments</button>
            </div>
        </div>

        <table class="table table-sm table-striped">
            <thead>
                <tr>
                    <th style="width:40px"></th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Team</th>
                    <th>Level</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var u in Model.Users)
            {
                var checkedAttr = Model.AssignedUserIds.Contains(u.Id) ? "checked" : "";
                <tr>
                    <td>
                        <input type="checkbox" name="userIds" value="@u.Id" @checkedAttr />
                    </td>
                    <td>@u.Name</td>
                    <td>@u.Email</td>
                    <td>@u.TeamId</td>
                    <td>@u.Level</td>
                </tr>
            }
            </tbody>
        </table>
    </form>
</div>

@if (TempData["Msg"] is string m)
{
    <div class="alert alert-success">@m</div>
}


